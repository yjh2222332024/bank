# 《谍影钱庄》团队标准作业程序 (TEAM SOP v1.0)

本手册定义了每位成员的工作范畴及解决技术问题的标准化流程。所有成员必须严格遵守。

---

## 一、 通用研发五步法 (Standard Problem Solving)
无论是修复 Bug 还是开发新特性，必须按以下步骤执行：

1.  **方案登记 (Research & Log)**: 在 `docs/logs/` 下创建日志，描述要解决的问题及拟采用的技术方案（涉及 API 变动必须先更新 `docs/04_API协议`）。
2.  **环境对齐 (Sync)**: 切换到自己的 `feature/*` 分支，并合并最新的 `develop` 分支。
3.  **编码实现 (Implementation)**: 严格按照 `AGENTS.md` 中的技术约束（原生、原子操作、复古色值）编写代码。
4.  **闭环验证 (Validation)**:
    *   **后端**: 在 `cloudfunctions/tests/` 编写测试脚本并通过。
    *   **前端**: 在微信开发者工具真机/模拟器中录屏/截屏确认 UI 表现。
5.  **提交评审 (PR & Review)**: 提交代码并推送，发起向 `develop` 的 PR，并在日志中记录“开发完成，请求 PM 审核”。

---

## 二、 岗位岗位职责 (Role Responsibilities)

### 组员 A (DM 管理侧前端) —— "战区司令部"
*   **核心任务**: 负责 `pages/dm-panel` 及其组件。
*   **关键准则**:
    *   确保 DM 操作路径最短化（一键扣划、批量发钱）。
    *   DM 端必须能实时看到全场玩家的连接状态与资产概况。
*   **解决问题重点**: 如何在大批量玩家操作时保持 UI 不卡顿，以及 DM 权限的本地二次确认。

### 组员 B (玩家侧前端) —— "一线特工"
*   **核心任务**: 负责 `pages/index` (选角)、`pages/asset` (看板) 及其交互。
*   **关键准则**:
    *   必须实现基于 `db.watch` 的 0 延迟余额变动动效。
    *   严格执行“红章盖下”和“数字跳动”的沉浸式体验。
*   **解决问题重点**: 监听断线重连、资产变动的视觉反馈。

### 组员 C (后端/逻辑核心) —— "机要处"
*   **核心任务**: 负责 `cloudfunctions/` 下的所有逻辑及数据库 `collections` 定义。
*   **关键准则**:
    *   所有资产变动必须使用 `db.command.inc` 原子操作。
    *   必须在云函数入口处强制校验调用者的 `openid` 权限。
*   **解决问题重点**: 解决高并发选角冲突、转账事务的一致性。

### 组员 D (QA/安全审计) —— "督察室"
*   **核心任务**: 负责 `docs/05_QA安全测试` 及 `cloudfunctions/tests` 下的自动化脚本。
*   **关键准则**:
    *   每周至少进行一次“越权测试”（尝试用玩家 OpenID 调用 DM 接口）。
    *   负责在合并至 `develop` 前对性能进行评估。
*   **解决问题重点**: 发现逻辑漏洞，并提供复现脚本。

---

## 三、 协作对接协议
1.  **接口先行**: 组员 C 定义好 API 入参和出参后，组员 A/B 才能开始联调。
2.  **UI 统一**: 组员 A/B 共享 `app.wxss` 中的复古色值变量，禁止私自定义颜色。
3.  **冲突裁决**: 任何关于“功能是否过度设计”的争论，由 PM (你) 终审。

---
**总负责人**: @PM  
**执行日期**: 2026-02-23
