# AGENT.md - 项目上下文与指令

此文件为 AGENT 提供必要的上下文，以便理解并参与 **《谍影钱庄》MVP (Spy-Bank-MVP)** 项目。

## 1. 项目概准 (Project Overview)
**《谍影钱庄》MVP** 是一款专门为微信小程序开发的银行/博弈类桌游辅助工具，基于 **微信云开发 (WeChat CloudBase)**。游戏采用 1940 年代复古谍战风格，玩家（特工）在高度紧张的金融谍战背景下管理资产、执行转账并与 DM（主持人）互动。

- **核心技术栈：** 微信小程序 (WXML, WXSS, JavaScript), 微信云开发 (云函数, 云数据库)。
- **核心架构：**
  - `miniprogram/`: 前端小程序应用代码。
  - `cloudfunctions/`: 后端逻辑及敏感操作（如转账、角色绑定）。
  - `docs/`: 完整的项目文档，包括 PRD、API 协议和团队规范。

## 2. 构建与运行 (Building and Running)
本项目主要通过 **微信开发者工具** 进行管理。

- **初始化步骤：**
  1. 打开微信开发者工具并导入项目根目录。
  2. 确保 `miniprogramRoot` 和 `cloudfunctionRoot` 分别正确指向 `miniprogram/` 和 `cloudfunctions/`（已在 `project.config.json` 中配置）。
  3. 如有需要，在 `miniprogram/` 和各个云函数目录中运行 `npm install`。
  4. 若添加了外部包，请使用开发者工具中的“构建 npm”功能。
- **测试与调试：**
  - 使用“云开发”控制台管理数据库和云函数。
  - 使用内置模拟器进行前端测试。
  - QA 脚本和测试用例详见 `docs/05_QA安全测试压测用例_v1.2.md`。

## 2. 强制性开发工作流 (Mandatory Workflow)
1. **日志先行 (Log First)**: 在执行任何代码修改前，必须在 `docs/logs/` 目录下创建或更新日志文件。未记录方案的代码一律不予通过。
2. **技术方案审核**: 复杂的逻辑（如转账、结算）必须先提交技术方案，经开发者/总负责人确认后方可编码。
3. **回归验证**: 每次修改后必须进行真机预览或云函数本地调试，并在日志中记录测试通过结论。

## 3. 开发规范 (Development Conventions)
项目遵循严格的工程和审美标准，以确保 MVP 的一致性。

- **Git 策略：** 轻量级 Git Flow。
  - `main`: 生产就绪代码（受保护）。
  - `develop`: 开发集成分支（受保护）。
  - `feature/*`: 个人功能开发分支。
  - `bugfix/*`: Bug 修复分支。
- **Commit 信息：** 遵循 Angular 规范 (`feat:`, `fix:`, `docs:`, `style:`, `refactor:`, `chore:`)。
- **视觉风格：** 1940 年代“复古谍战” (Retro Spy)。
  - 核心色值：`#E8E2D0` (做旧纸张色), `#2B2B2B` (油墨黑), `#8B0000` (印章红)。
  - UI 生成请参考 `.cursorrules`。
- **安全性：** 所有关键业务逻辑（资产操作、角色绑定）**必须**在 `cloudfunctions/` 中实现。
- **忽略规则：** 严禁提交 `project.private.config.json` 或 `node_modules`。

## 4. 技术栈约束 (Tech Stack Constraints)
- **原生开发优先**: 仅使用微信小程序原生 WXML/WXSS/JS，禁止跨端框架。
- **云开发原生**: 所有业务逻辑必须通过 Node.js 云函数执行，充分利用微信提供的天然鉴权。
- **低依赖策略**: 严禁随意引入庞大的第三方 npm 包，如非必要，尽量手写实现或选用极简库（如 `dayjs`）。
- **Schema 驱动**: 所有的数据库操作必须以 `docs/03_云数据库表结构_v1.2.md` 为唯一真理来源。

## 5. 关键目录结构 (Key Directory Structure)
- `miniprogram/pages/`: 包含主要应用视图（index, asset, dm-panel）。
- `docs/`: 
  - `01_产品需求文档_PRD.md`: 核心产品逻辑与游戏规模（8-12人）。
  - `03_云数据库表结构_v1.2.md`: 数据库 Schema 定义。
  - `04_API协议与实时规范_v1.2.md`: 前后端通讯协议。
  - `06_Git协同规范_v1.2.md`: 详细的团队协作规则。

## 5. 给 Gemini 的指令上下文
在协助此项目时：
- **风格风格：** 在 UI 建议中严格遵守 1940 年代复古审美。
- **逻辑实现：** 涉及数据敏感任务时，优先考虑云函数实现。
- **参考文档：** 在提出任何更改建议前，务必查阅 `docs/` 文件夹中的具体 API 和数据库定义。
- **工作流：** 提醒用户创建特性分支并遵循 Commit 信息格式。
